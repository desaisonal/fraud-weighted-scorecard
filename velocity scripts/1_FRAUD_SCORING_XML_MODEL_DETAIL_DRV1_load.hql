SET hive.stats.autogather=false;
SET hive.exec.compress.output=true; 
SET mapred.output.compression.codec=org.apache.hadoop.io.compress.SnappyCodec; 
SET mapred.output.compression.type=BLOCK;
SET hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat;

USE gfora;

DROP TABLE FRAUD_SCORING_XML_MODEL_DETAIL_DRV1;

CREATE TABLE FRAUD_SCORING_XML_MODEL_DETAIL_DRV1
ROW FORMAT DELIMITED
STORED AS SEQUENCEFILE
AS

SELECT
  FRAUD_TRANSACTION_ID
 ,ORDER_LINE_GUID
 ,ITEM_AMOUNT
 ,coalesce(exp_currency_convert(cast(ITEM_AMOUNT as double), ITEM_CURRENCY_CODE, 'USD', fraud_transaction_create_date),0) as ITEM_AMOUNT_USD_DERIVED
 ,ITEM_CURRENCY_CODE
 ,PRODUCT_ITEM_COUNT
 ,TRAVELER_PHONE_NUMBER_COUNT
 ,TRAVELER_1_EMAIL_ADDRESS
 ,TRAVELER_2_EMAIL_ADDRESS
 ,TRAVELER_3_EMAIL_ADDRESS
 ,TRAVELER_4_EMAIL_ADDRESS
 ,TRAVELER_5_EMAIL_ADDRESS
 ,concat_ws(' ',TRAVELER_GIVEN_NAME_1, TRAVELER_MIDDLE_NAME_1, TRAVELER_LAST_NAME_1) as TRAVELER_FULL_NAME_DERIVED_1
 ,TRAVELER_GIVEN_NAME_1
 ,TRAVELER_MIDDLE_NAME_1
 ,TRAVELER_LAST_NAME_1
 ,TRAVELER_GENDER_NAME_1
 ,TRAVELER_IS_PRIMARY_1
 ,TRAVELER_IS_GIVEN_NAME_LOWER_CASE_1
 ,TRAVELER_IS_GIVEN_NAME_UPPER_CASE_1
 ,TRAVELER_IS_SURNAME_LOWER_CASE_1
 ,TRAVELER_IS_SURNAME_UPPER_CASE_1
 ,concat_ws(' ',TRAVELER_GIVEN_NAME_2, TRAVELER_MIDDLE_NAME_2, TRAVELER_LAST_NAME_2) as TRAVELER_FULL_NAME_DERIVED_2
 ,TRAVELER_GIVEN_NAME_2
 ,TRAVELER_MIDDLE_NAME_2
 ,TRAVELER_LAST_NAME_2
 ,TRAVELER_GENDER_NAME_2
 ,TRAVELER_IS_PRIMARY_2
 ,TRAVELER_IS_GIVEN_NAME_LOWER_CASE_2
 ,TRAVELER_IS_GIVEN_NAME_UPPER_CASE_2
 ,TRAVELER_IS_SURNAME_LOWER_CASE_2
 ,TRAVELER_IS_SURNAME_UPPER_CASE_2
 ,concat_ws(' ',TRAVELER_GIVEN_NAME_3, TRAVELER_MIDDLE_NAME_3, TRAVELER_LAST_NAME_3) as TRAVELER_FULL_NAME_DERIVED_3
 ,TRAVELER_GIVEN_NAME_3
 ,TRAVELER_MIDDLE_NAME_3
 ,TRAVELER_LAST_NAME_3
 ,TRAVELER_GENDER_NAME_3
 ,TRAVELER_IS_PRIMARY_3
 ,TRAVELER_IS_GIVEN_NAME_LOWER_CASE_3
 ,TRAVELER_IS_GIVEN_NAME_UPPER_CASE_3
 ,TRAVELER_IS_SURNAME_LOWER_CASE_3
 ,TRAVELER_IS_SURNAME_UPPER_CASE_3
 ,concat_ws(' ',TRAVELER_GIVEN_NAME_4, TRAVELER_MIDDLE_NAME_4, TRAVELER_LAST_NAME_4) as TRAVELER_FULL_NAME_DERIVED_4
 ,TRAVELER_GIVEN_NAME_4
 ,TRAVELER_MIDDLE_NAME_4
 ,TRAVELER_LAST_NAME_4
 ,TRAVELER_GENDER_NAME_4
 ,TRAVELER_IS_PRIMARY_4
 ,TRAVELER_IS_GIVEN_NAME_LOWER_CASE_4
 ,TRAVELER_IS_GIVEN_NAME_UPPER_CASE_4
 ,TRAVELER_IS_SURNAME_LOWER_CASE_4
 ,TRAVELER_IS_SURNAME_UPPER_CASE_4
 ,concat_ws(' ',TRAVELER_GIVEN_NAME_5, TRAVELER_MIDDLE_NAME_5, TRAVELER_LAST_NAME_5) as TRAVELER_FULL_NAME_DERIVED_5
 ,TRAVELER_GIVEN_NAME_5
 ,TRAVELER_MIDDLE_NAME_5
 ,TRAVELER_LAST_NAME_5
 ,TRAVELER_GENDER_NAME_5
 ,TRAVELER_IS_PRIMARY_5
 ,TRAVELER_IS_GIVEN_NAME_LOWER_CASE_5
 ,TRAVELER_IS_GIVEN_NAME_UPPER_CASE_5
 ,TRAVELER_IS_SURNAME_LOWER_CASE_5
 ,TRAVELER_IS_SURNAME_UPPER_CASE_5
 ,concat_ws(' ',TRAVELER_1_BUSINESS_PHONE_COUNTRY_ACCESS_CODE, TRAVELER_1_BUSINESS_PHONE_AREA_CODE, TRAVELER_1_BUSINESS_PHONE_NUMBER) as TRAVELER_1_BUSINESS_PHONE_DERIVED
 ,TRAVELER_1_BUSINESS_PHONE_AREA_CODE
 ,TRAVELER_1_BUSINESS_PHONE_COUNTRY_ACCESS_CODE
 ,TRAVELER_1_BUSINESS_PHONE_NUMBER
 ,concat_ws(' ',TRAVELER_1_HOME_PHONE_COUNTRY_ACCESS_CODE, TRAVELER_1_HOME_PHONE_AREA_CODE, TRAVELER_1_HOME_PHONE_NUMBER) as TRAVELER_1_HOME_PHONE_DERIVED
 ,TRAVELER_1_HOME_PHONE_AREA_CODE
 ,TRAVELER_1_HOME_PHONE_COUNTRY_ACCESS_CODE
 ,TRAVELER_1_HOME_PHONE_NUMBER
 ,concat_ws(' ',TRAVELER_1_MOBILE_PHONE_COUNTRY_ACCESS_CODE, TRAVELER_1_MOBILE_PHONE_AREA_CODE, TRAVELER_1_MOBILE_PHONE_NUMBER) as TRAVELER_1_MOBILE_PHONE_DERIVED
 ,TRAVELER_1_MOBILE_PHONE_AREA_CODE
 ,TRAVELER_1_MOBILE_PHONE_COUNTRY_ACCESS_CODE
 ,TRAVELER_1_MOBILE_PHONE_NUMBER
 ,concat_ws(' ',TRAVELER_2_BUSINESS_PHONE_COUNTRY_ACCESS_CODE, TRAVELER_2_BUSINESS_PHONE_AREA_CODE, TRAVELER_2_BUSINESS_PHONE_NUMBER) as TRAVELER_2_BUSINESS_PHONE_DERIVED
 ,TRAVELER_2_BUSINESS_PHONE_AREA_CODE
 ,TRAVELER_2_BUSINESS_PHONE_COUNTRY_ACCESS_CODE
 ,TRAVELER_2_BUSINESS_PHONE_NUMBER
 ,concat_ws(' ',TRAVELER_2_HOME_PHONE_COUNTRY_ACCESS_CODE, TRAVELER_2_HOME_PHONE_AREA_CODE, TRAVELER_2_HOME_PHONE_NUMBER) as TRAVELER_2_HOME_PHONE_DERIVED
 ,TRAVELER_2_HOME_PHONE_AREA_CODE
 ,TRAVELER_2_HOME_PHONE_COUNTRY_ACCESS_CODE
 ,TRAVELER_2_HOME_PHONE_NUMBER
 ,concat_ws(' ',TRAVELER_2_MOBILE_PHONE_COUNTRY_ACCESS_CODE, TRAVELER_2_MOBILE_PHONE_AREA_CODE, TRAVELER_2_MOBILE_PHONE_NUMBER) as TRAVELER_2_MOBILE_PHONE_DERIVED
 ,TRAVELER_2_MOBILE_PHONE_AREA_CODE
 ,TRAVELER_2_MOBILE_PHONE_COUNTRY_ACCESS_CODE
 ,TRAVELER_2_MOBILE_PHONE_NUMBER
 ,concat_ws(' ',TRAVELER_3_BUSINESS_PHONE_COUNTRY_ACCESS_CODE, TRAVELER_3_BUSINESS_PHONE_AREA_CODE, TRAVELER_3_BUSINESS_PHONE_NUMBER) as TRAVELER_3_BUSINESS_PHONE_DERIVED
 ,TRAVELER_3_BUSINESS_PHONE_AREA_CODE
 ,TRAVELER_3_BUSINESS_PHONE_COUNTRY_ACCESS_CODE
 ,TRAVELER_3_BUSINESS_PHONE_NUMBER
 ,concat_ws(' ',TRAVELER_3_HOME_PHONE_COUNTRY_ACCESS_CODE, TRAVELER_3_HOME_PHONE_AREA_CODE, TRAVELER_3_HOME_PHONE_NUMBER) as TRAVELER_3_HOME_PHONE_DERIVED
 ,TRAVELER_3_HOME_PHONE_AREA_CODE
 ,TRAVELER_3_HOME_PHONE_COUNTRY_ACCESS_CODE
 ,TRAVELER_3_HOME_PHONE_NUMBER
 ,concat_ws(' ',TRAVELER_3_MOBILE_PHONE_COUNTRY_ACCESS_CODE, TRAVELER_3_MOBILE_PHONE_AREA_CODE, TRAVELER_3_MOBILE_PHONE_NUMBER) as TRAVELER_3_MOBILE_PHONE_DERIVED
 ,TRAVELER_3_MOBILE_PHONE_AREA_CODE
 ,TRAVELER_3_MOBILE_PHONE_COUNTRY_ACCESS_CODE
 ,TRAVELER_3_MOBILE_PHONE_NUMBER
 ,concat_ws(' ',TRAVELER_4_BUSINESS_PHONE_COUNTRY_ACCESS_CODE, TRAVELER_4_BUSINESS_PHONE_AREA_CODE, TRAVELER_4_BUSINESS_PHONE_NUMBER) as TRAVELER_4_BUSINESS_PHONE_DERIVED
 ,TRAVELER_4_BUSINESS_PHONE_AREA_CODE
 ,TRAVELER_4_BUSINESS_PHONE_COUNTRY_ACCESS_CODE
 ,TRAVELER_4_BUSINESS_PHONE_NUMBER
 ,concat_ws(' ',TRAVELER_4_HOME_PHONE_COUNTRY_ACCESS_CODE, TRAVELER_4_HOME_PHONE_AREA_CODE, TRAVELER_4_HOME_PHONE_NUMBER) as TRAVELER_4_HOME_PHONE_DERIVED
 ,TRAVELER_4_HOME_PHONE_AREA_CODE
 ,TRAVELER_4_HOME_PHONE_COUNTRY_ACCESS_CODE
 ,TRAVELER_4_HOME_PHONE_NUMBER
 ,concat_ws(' ',TRAVELER_4_MOBILE_PHONE_COUNTRY_ACCESS_CODE, TRAVELER_4_MOBILE_PHONE_AREA_CODE, TRAVELER_4_MOBILE_PHONE_NUMBER) as TRAVELER_4_MOBILE_PHONE_DERIVED
 ,TRAVELER_4_MOBILE_PHONE_AREA_CODE
 ,TRAVELER_4_MOBILE_PHONE_COUNTRY_ACCESS_CODE
 ,TRAVELER_4_MOBILE_PHONE_NUMBER
 ,concat_ws(' ',TRAVELER_5_BUSINESS_PHONE_COUNTRY_ACCESS_CODE, TRAVELER_5_BUSINESS_PHONE_AREA_CODE, TRAVELER_5_BUSINESS_PHONE_NUMBER) as TRAVELER_5_BUSINESS_PHONE_DERIVED
 ,TRAVELER_5_BUSINESS_PHONE_AREA_CODE
 ,TRAVELER_5_BUSINESS_PHONE_COUNTRY_ACCESS_CODE
 ,TRAVELER_5_BUSINESS_PHONE_NUMBER
 ,concat_ws(' ',TRAVELER_5_HOME_PHONE_COUNTRY_ACCESS_CODE, TRAVELER_5_HOME_PHONE_AREA_CODE, TRAVELER_5_HOME_PHONE_NUMBER) as TRAVELER_5_HOME_PHONE_DERIVED
 ,TRAVELER_5_HOME_PHONE_AREA_CODE
 ,TRAVELER_5_HOME_PHONE_COUNTRY_ACCESS_CODE
 ,TRAVELER_5_HOME_PHONE_NUMBER
 ,concat_ws(' ',TRAVELER_5_MOBILE_PHONE_COUNTRY_ACCESS_CODE, TRAVELER_5_MOBILE_PHONE_AREA_CODE, TRAVELER_5_MOBILE_PHONE_NUMBER) as TRAVELER_5_MOBILE_PHONE_DERIVED
 ,TRAVELER_5_MOBILE_PHONE_AREA_CODE
 ,TRAVELER_5_MOBILE_PHONE_COUNTRY_ACCESS_CODE
 ,TRAVELER_5_MOBILE_PHONE_NUMBER
 ,TRAVELER_IS_ANY_GIVEN_NAME_LOWER_CASE
 ,TRAVELER_IS_ANY_GIVEN_NAME_UPPER_CASE
 ,TRAVELER_IS_ANY_SURNAME_LOWER_CASE
 ,TRAVELER_IS_ANY_SURNAME_UPPER_CASE
 ,MODEL_HIGHEST_IS_PAY_AREA_CODE_PRIM_TRAV_LOOKUP_VALUE
 ,MODEL_HIGHEST_IS_PAY_AREA_CODE_ACCOUNT_LOOKUP_VALUE
 ,MODEL_HIGHEST_IS_PAY_GIVEN_NAME_PRIM_TRAV_LOOKUP_VALUE
 ,MODEL_HIGHEST_IS_PAY_LOCAL_NBR_ACCOUNT_LOOKUP_VALUE
 ,MODEL_HIGHEST_IS_PAY_SURNAME_EMAIL_NAME_LOOKUP_VALUE
 ,MODEL_IS_PRIM_TRAV_SURNAME_EMAIL_NAME_LOOKUP_VALUE
 ,MODEL_HIGHEST_IS_PAY_STATE_PROV_IP_LOOKUP_VALUE
 ,MODEL_PRIM_TRAV_PHONE_REPEATING_NBR_PCT_LOOKUP_VALUE
 ,MODEL_HIGHEST_IS_PAYMENT_CITY_HOTEL_LOOKUP_VALUE
FROM
ETLDATA.FRAUD_SCORING_XML_MODEL_DETAIL
WHERE
substr(fraud_transaction_create_date,1,4)='2013'
;
